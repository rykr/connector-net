<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment Id='ProvidersFragment'>
    <DirectoryRef Id='INSTALLDIR'>
      <Directory Id='WPDir' Name='Web Providers'>
        <Component Id="ProvidersGAC" Guid="6b95d34b-91e1-41ff-9f3f-dcb5308a00ce">
          <File Id="ProviderAssemblyGAC" Name="MySql.Web.dll" ShortName="MW"
                Source="..\MySql.Web\bin\release\mysql.web.dll" DiskId="1" Assembly=".net" KeyPath="yes"/>
        </Component>
        <Component Id="Providers" Guid="8578813e-e123-45ad-9c92-565382a058b6">
          <File Id="ProviderAssembly" Name="MySql.Web.dll" DiskId="1"
                Source="..\MySql.Web\bin\release\mysql.web.dll"/>
        </Component>
      </Directory>
    </DirectoryRef>

    <Feature Id='WebProviders' Display='7' Level='1' Title='Web Providers'
             Description='ASP.Net Web Providers'>
      <ComponentRef Id='Providers'/>
      <ComponentRef Id='ProvidersGAC'/>
    </Feature>

    <CustomAction Id="WPSetPrereqs" BinaryKey="MSVBDPCADLL" DllEntry="CheckFX" Impersonate="no" />
    <CustomAction Id="WPCASetProp" Property="WPInstallCA"  Impersonate="no"
                  Value="/installtype=notransaction /action=install /LogFile= &quot;[#ProviderAssembly]&quot; &quot;[VSDFxConfigFile]&quot;"/>
    <CustomAction Id="WPInstallCA" BinaryKey="InstallUtil" DllEntry="ManagedInstall"
                  Execute="deferred" Impersonate="no"/>

    <CustomAction Id="WPSetPrereqs1" BinaryKey="MSVBDPCADLL" DllEntry="CheckFX" Impersonate="no"/>
    <CustomAction Id="WPCAUnSetProp" Property="WPRemoveCA" Impersonate="no"
                  Value="/installtype=notransaction /action=uninstall /LogFile= &quot;[#ProviderAssembly]&quot; &quot;[VSDFxConfigFile]&quot;"/>
    <CustomAction Id="WPRemoveCA" BinaryKey="InstallUtil" DllEntry="ManagedInstall"
                  Execute="deferred" Impersonate="no" />

    <InstallExecuteSequence>
      <!-- Install code -->
      <Custom Action="WPSetPrereqs" After="InstallFiles"><![CDATA[ $Providers > 2 ]]></Custom>
      <Custom Action="WPCASetProp" After="WPSetPrereqs"><![CDATA[ $Providers > 2 ]]></Custom>
      <Custom Action="WPInstallCA" After="WPCASetProp"><![CDATA[ $Providers > 2 ]]></Custom>

      <!-- UnInstall code -->
      <Custom Action="WPSetPrereqs1" Before="RemoveFiles"><![CDATA[ $Providers = 2 ]]></Custom>
      <Custom Action="WPCAUnSetProp" After="WPSetPrereqs1"><![CDATA[ $Providers = 2 ]]></Custom>
      <Custom Action="WPRemoveCA" After="WPCAUnSetProp"><![CDATA[ $Providers = 2 ]]></Custom>
    </InstallExecuteSequence>
    
  </Fragment>
</Wix>


